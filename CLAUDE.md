# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

`tabf` is an R package for creating publication-ready tables for public health research, particularly Table 1 (descriptive statistics) and logistic regression model summaries with odds ratios and confidence intervals.

## Development Commands

### Building and Documentation
```r
# Generate documentation from roxygen2 comments
roxygen2::roxygenise()

# Build package
R CMD build .

# Check package
R CMD check tabf_*.tar.gz

# Install locally for testing
devtools::install()
```

### Testing Functions
Use the R console or create test scripts in the `rscript/` directory:
```r
# Load package for development
devtools::load_all()

# Test functions interactively
source("rscript/testing1.R")
```

## Architecture

### Core Functions (R/tabf.R)

All functions are defined in a single file `R/tabf.R`. The package follows a functional pipeline approach using tidyverse patterns.

**Statistical Testing Functions:**
- `tab.Chisq()` - Chi-square tests for categorical variables
- `tab.Ttest()` - T-tests for continuous variables

**Table 1 Generation:**
- `tabf()` - Creates descriptive statistics table with column-wise percentages (most common)
- `tabf2()` - Creates descriptive statistics table with row-wise percentages

Both functions:
- Accept categorical variables (`catVars`) and continuous variables (`conVars`)
- Stratify by a grouping variable (`stratas`)
- Automatically compute appropriate statistical tests (chi-square for categorical, t-test for continuous)
- Format output as N (%) for categorical and meanÂ±SD for continuous variables
- Return a data frame that can be further formatted for publication

**Logistic Regression Model Summaries:**
- `modsmryf()` - Extracts OR, 95% CI, and p-values from logistic regression models
- `oddf()` - Formats a single logistic model as OR(95% CI) with HTML formatting for significant results
- `oddf0()` - Similar to `oddf()` but returns numeric values instead of formatted strings
- `oddsf()` - Combines multiple models side-by-side for comparison
- `oddsTabf()` - Combines multiple models and outputs as HTML table with formatting

**Key Implementation Details:**
- Uses `pivot_longer()`/`pivot_wider()` for data reshaping
- Employs `nest()`/`map()` pattern for applying statistical tests to grouped data
- Handles missing categorical or continuous variables gracefully with placeholder data
- Preserves variable order using explicit ordering tibbles
- Formats reference categories as italic "1.00 (reference)" and significant results in bold

## Package Structure

- `R/tabf.R` - All exported functions (single file architecture)
- `man/` - Auto-generated documentation from roxygen2 comments
- `data/` - Package datasets (if any)
- `rscript/` - Development and testing scripts (not part of package)
- `bkup/` - Backup files from previous versions
- `NAMESPACE` - Auto-generated by roxygen2
- `DESCRIPTION` - Package metadata

## Editing Guidelines

- All function modifications go in `R/tabf.R`
- Update roxygen2 comments (lines starting with `#'`) above each function for documentation changes
- Run `roxygen2::roxygenise()` after editing roxygen comments to update `NAMESPACE` and `man/` files
- Test changes by running `devtools::load_all()` and using the functions interactively
- The package depends on tidyverse packages (dplyr, tidyr, purrr, stringr) and broom for tidy statistical output

## Git

**IMPORTANT:** Before performing any git-related work, read the `gitinformation` file for authentication credentials and configuration details.

```bash
cat gitinformation
```

The gitinformation file contains sensitive authentication tokens and should never be committed (it is excluded via .gitignore).

## Important Instruction Reminders
Do what has been asked; nothing more, nothing less.
NEVER create files unless they're absolutely necessary for achieving your goal.
ALWAYS prefer editing an existing file to creating a new one.
NEVER proactively create documentation files (*.md) or README files. Only create documentation files if explicitly requested by the User.
